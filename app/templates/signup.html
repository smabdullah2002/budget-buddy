{% extends 'base.html' %}
{% block title %}Sign up â€” Budget Buddy{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-primary-700">Create your account</h1>
<form id="signupForm" class="mt-6 max-w-md space-y-4">
  <div>
    <label class="block text-sm text-gray-700">Email</label>
    <input type="email" name="email" class="mt-1 w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-400" required />
  </div>
  <div>
    <label class="block text-sm text-gray-700">Username</label>
    <input type="text" name="username" class="mt-1 w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-400" required />
  </div>
  <div>
    <label class="block text-sm text-gray-700">Password</label>
    <input type="password" name="password" class="mt-1 w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-400" required />
  </div>
  <button class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md">Sign up</button>
  <p id="signupError" class="text-red-600 text-sm mt-2 hidden"></p>
</form>
<script>
  const form = document.getElementById('signupForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const payload = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch('/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Signup failed');
      // auto login
      const loginRes = await fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ username: payload.email, password: payload.password })
      });
      const loginData = await loginRes.json();
      localStorage.setItem('token', loginData.access_token);
      window.location.href = '/dashboard';
    } catch (err) {
      const el = document.getElementById('signupError');
      el.textContent = err.message || 'Signup failed';
      el.classList.remove('hidden');
    }
  });
</script>
{% endblock %}
